<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>TG Parser Sender ¬∑ Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: #0a0c10;
      color: #e5e9f0;
      line-height: 1.5;
    }

    .app {
      display: flex;
      min-height: 100vh;
    }

    /* –°–∞–π–¥–±–∞—Ä */
    .sidebar {
      width: 280px;
      background: #0f1217;
      border-right: 1px solid #1e242c;
      padding: 24px 16px;
    }

    .logo {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.5px;
      margin-bottom: 32px;
      padding-left: 12px;
    }

    .logo span {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 12px;
      color: #9aa4b2;
      margin-bottom: 4px;
      transition: all 0.2s;
      cursor: default;
    }

    .nav-item.active {
      background: #1a1f2a;
      color: #fff;
    }

    .nav-item i {
      width: 20px;
      font-size: 18px;
    }

    .nav-item:hover:not(.active) {
      background: #151a24;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
    .main {
      flex: 1;
      padding: 32px 40px;
      background: #0a0c10;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 600;
      letter-spacing: -0.5px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .admin-badge {
      background: #1a1f2a;
      padding: 8px 16px;
      border-radius: 40px;
      font-size: 14px;
      color: #9aa4b2;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logout-btn {
      background: #2d3340;
      border: none;
      color: #ff7b7b;
      padding: 8px 20px;
      border-radius: 40px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .logout-btn:hover {
      background: #3a4050;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: #0f1217;
      border: 1px solid #1e242c;
      border-radius: 20px;
      padding: 20px;
      transition: transform 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      border-color: #2d3540;
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: #1a1f2a;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      font-size: 20px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      color: #9aa4b2;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .stat-detail {
      font-size: 13px;
      color: #6b7a8f;
      display: flex;
      gap: 12px;
    }

    .stat-detail span.active { color: #7CFFB2; }
    .stat-detail span.expired { color: #ffd37b; }
    .stat-detail span.revoked { color: #ff7b7b; }

    /* –¢–∞–±—ã */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 1px solid #1e242c;
      padding-bottom: 16px;
    }

    .tab {
      padding: 8px 20px;
      border-radius: 40px;
      background: transparent;
      color: #9aa4b2;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }

    .tab.active {
      background: #1a1f2a;
      color: #fff;
    }

    .tab:hover:not(.active) {
      background: #151a24;
    }

    /* Search & Filter */
    .action-bar {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 300px;
      display: flex;
      gap: 8px;
    }

    .search-box input {
      flex: 1;
      background: #0f1217;
      border: 1px solid #1e242c;
      border-radius: 40px;
      padding: 12px 20px;
      color: #e5e9f0;
      font-size: 14px;
    }

    .search-box input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .search-box select {
      background: #0f1217;
      border: 1px solid #1e242c;
      border-radius: 40px;
      padding: 0 20px;
      color: #e5e9f0;
    }

    .btn-primary {
      background: #3b82f6;
      border: none;
      border-radius: 40px;
      padding: 12px 32px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: #1e242c;
      border: 1px solid #2d3540;
      border-radius: 40px;
      padding: 12px 24px;
      color: #e5e9f0;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .btn-secondary:hover {
      background: #2a3140;
    }

    /* Create License Card */
    .create-card {
      background: #0f1217;
      border: 1px solid #1e242c;
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 32px;
    }

    .create-card h3 {
      margin-bottom: 20px;
      font-size: 18px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      background: #0a0c10;
      border: 1px solid #1e242c;
      border-radius: 12px;
      padding: 12px 16px;
      color: #e5e9f0;
    }

    .form-group input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .generate-section {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      padding-top: 16px;
      border-top: 1px solid #1e242c;
    }

    /* Table */
    .table-container {
      background: #0f1217;
      border: 1px solid #1e242c;
      border-radius: 20px;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th {
      text-align: left;
      padding: 18px 16px;
      color: #9aa4b2;
      font-weight: 500;
      border-bottom: 1px solid #1e242c;
    }

    td {
      padding: 16px;
      border-bottom: 1px solid #1e242c;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover td {
      background: #151a24;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 40px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge.active {
      background: rgba(124, 255, 178, 0.1);
      color: #7CFFB2;
      border: 1px solid rgba(124, 255, 178, 0.2);
    }

    .badge.expired {
      background: rgba(255, 211, 123, 0.1);
      color: #ffd37b;
      border: 1px solid rgba(255, 211, 123, 0.2);
    }

    .badge.revoked {
      background: rgba(255, 123, 123, 0.1);
      color: #ff7b7b;
      border: 1px solid rgba(255, 123, 123, 0.2);
    }

    .actions {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 6px 12px;
      border-radius: 30px;
      font-size: 12px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .action-btn.ok {
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .action-btn.ok:hover {
      background: #22c55e;
      color: #fff;
    }

    .action-btn.warn {
      background: rgba(255, 123, 123, 0.1);
      color: #ff7b7b;
      border: 1px solid rgba(255, 123, 123, 0.2);
    }

    .action-btn.warn:hover {
      background: #ff7b7b;
      color: #fff;
    }

    .action-btn.secondary {
      background: rgba(155, 164, 178, 0.1);
      color: #9aa4b2;
      border: 1px solid rgba(155, 164, 178, 0.2);
    }

    .action-btn.secondary:hover {
      background: #2d3540;
      color: #fff;
    }

    .mono {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
    }

    .footer-note {
      margin-top: 20px;
      color: #6b7a8f;
      font-size: 13px;
      text-align: center;
    }
  </style>
</head>
<body>
<div class="app">
  <!-- –°–∞–π–¥–±–∞—Ä -->
  <div class="sidebar">
    <div class="logo">
      <span>TG Parser</span> Sender
    </div>
    
    <div class="nav-item active">
      <i>üìä</i> –î–∞—à–±–æ—Ä–¥
    </div>
    <div class="nav-item">
      <i>üîë</i> –õ–∏—Ü–µ–Ω–∑–∏–∏
    </div>
    <div class="nav-item">
      <i>üë•</i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    </div>
    <div class="nav-item">
      <i>üíª</i> –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    </div>
    <div class="nav-item">
      <i>üí∞</i> –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    </div>
    <div class="nav-item">
      <i>‚öôÔ∏è</i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="main">
    <div class="header">
      <h1>–î–∞—à–±–æ—Ä–¥</h1>
      <div class="header-right">
        <div class="admin-badge">
          <span>üëë</span> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
        </div>
        <form method="post" action="/admin/logout" style="margin:0;">
          <button class="logout-btn" type="submit">–í—ã–π—Ç–∏</button>
        </form>
      </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üîë</div>
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">–í—Å–µ–≥–æ –ª–∏—Ü–µ–Ω–∑–∏–π</div>
        <div class="stat-detail">
          <span class="active">{{ stats.active }} –∞–∫—Ç–∏–≤–Ω—ã—Ö</span>
          <span class="expired">{{ stats.expired }} –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
          <span class="revoked">{{ stats.revoked }} –∑–∞–±–ª–æ–∫.</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-value">{{ stats.total_users }}</div>
        <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
        <div class="stat-detail">
          <span style="color:#7CFFB2;">{{ stats.confirmed_users }}</span> –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ email
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-value">${{ "%.2f"|format(stats.total_balance) }}</div>
        <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
        <div class="stat-detail">
          –ø–æ—Ç—Ä–∞—á–µ–Ω–æ: ${{ "%.2f"|format(stats.total_revenue) }}
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üíª</div>
        <div class="stat-value">{{ stats.total_devices }}</div>
        <div class="stat-label">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</div>
        <div class="stat-detail">
          —É {{ stats.users_with_devices }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        </div>
      </div>
    </div>

    <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä -->
    <div class="action-bar">
      <div class="search-box">
        <input type="text" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ key, hwid, note..." value="{{ q or '' }}">
        <select>
          <option value="all" {% if status=="all" %}selected{% endif %}>–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
          <option value="active" {% if status=="active" %}selected{% endif %}>Active</option>
          <option value="expired" {% if status=="expired" %}selected{% endif %}>Expired</option>
          <option value="revoked" {% if status=="revoked" %}selected{% endif %}>Revoked</option>
        </select>
        <button class="btn-primary">–ù–∞–π—Ç–∏</button>
      </div>
      <a href="/admin/export" style="text-decoration:none;">
        <button class="btn-secondary">üì• –≠–∫—Å–ø–æ—Ä—Ç CSV</button>
      </a>
    </div>

    <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ -->
    <div class="create-card">
      <h3>‚ú® –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ª–∏—Ü–µ–Ω–∑–∏—é</h3>
      <form method="post" action="/admin/upsert">
        <div class="form-grid">
          <div class="form-group">
            <input name="key" placeholder="KEY (–Ω–∞–ø—Ä–∏–º–µ—Ä MY-PC-001)" required>
          </div>
          <div class="form-group">
            <input name="hwid" placeholder="HWID (UUID –∫–ª–∏–µ–Ω—Ç–∞)" required>
          </div>
          <div class="form-group">
            <input name="days" type="number" placeholder="–°—Ä–æ–∫ (–¥–Ω–∏)" value="30" required>
          </div>
          <div class="form-group">
            <select name="plan">
              <option value="custom">custom (–±–∞–∑–æ–≤—ã–π)</option>
              <option value="m1">m1 (1 –º–µ—Å—è—Ü)</option>
              <option value="m3">m3 (3 –º–µ—Å—è—Ü–∞)</option>
              <option value="m6">m6 (6 –º–µ—Å—è—Ü–µ–≤)</option>
              <option value="y1">y1 (1 –≥–æ–¥)</option>
            </select>
          </div>
          <div class="form-group">
            <input name="note" placeholder="–ó–∞–º–µ—Ç–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
          </div>
        </div>
        <div class="generate-section">
          <button class="btn-primary" type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é</button>
          <span style="color:#9aa4b2;">–∏–ª–∏</span>
          <button class="btn-secondary" type="button" onclick="alert('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: VIP-' + Math.random().toString(36).substring(7).toUpperCase())">üé≤ Generate KEY</button>
          <span style="color:#6b7a8f; font-size:13px; margin-left:auto;">
            –°–æ–≤–µ—Ç: –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç HWID ‚Üí —Ç—ã –≥–µ–Ω–µ—Ä–∏—à—å KEY
          </span>
        </div>
      </form>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –ª–∏—Ü–µ–Ω–∑–∏–π -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>KEY</th>
            <th>HWID</th>
            <th>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–ü–ª–∞–Ω</th>
            <th>–ü—Ä–æ–≤–µ—Ä–æ–∫</th>
            <th>–ó–∞–º–µ—Ç–∫–∞</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
        {% for r in rows %}
          <tr>
            <td class="mono"><b>{{ r.key }}</b></td>
            <td class="mono">{{ r.hwid[:16] }}...</td>
            <td class="mono">{{ r.expires_at.strftime('%Y-%m-%d') }}</td>
            <td>
              {% if r.revoked %}
                <span class="badge revoked">revoked</span>
              {% elif r.expires_at <= now %}
                <span class="badge expired">expired</span>
              {% else %}
                <span class="badge active">active</span>
              {% endif %}
            </td>
            <td><span class="badge">{{ r.plan }}</span></td>
            <td>{{ r.check_count }}</td>
            <td>{{ r.note or '‚Äî' }}</td>
            <td>
              <div class="actions">
                <form method="post" action="/admin/add_days" style="display:inline;">
                  <input type="hidden" name="key" value="{{ r.key }}">
                  <input type="hidden" name="add" value="30">
                  <button class="action-btn ok" type="submit">+30</button>
                </form>
                <form method="post" action="/admin/add_days" style="display:inline;">
                  <input type="hidden" name="key" value="{{ r.key }}">
                  <input type="hidden" name="add" value="90">
                  <button class="action-btn secondary" type="submit">+90</button>
                </form>
                {% if r.revoked %}
                <form method="post" action="/admin/unrevoke" style="display:inline;">
                  <input type="hidden" name="key" value="{{ r.key }}">
                  <button class="action-btn secondary" type="submit">Unrevoke</button>
                </form>
                {% else %}
                <form method="post" action="/admin/revoke" style="display:inline;" onsubmit="return confirm('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á {{ r.key }}?');">
                  <input type="hidden" name="key" value="{{ r.key }}">
                  <button class="action-btn warn" type="submit">Revoke</button>
                </form>
                {% endif %}
                <form method="post" action="/admin/delete" style="display:inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–ª—é—á {{ r.key }}? –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!');">
                  <input type="hidden" name="key" value="{{ r.key }}">
                  <button class="action-btn warn" type="submit">Delete</button>
                </form>
              </div>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="footer-note">
      –ü–æ–∫–∞–∑–∞–Ω–æ –º–∞–∫—Å–∏–º—É–º 500 –∑–∞–ø–∏—Å–µ–π ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã
    </div>
  </div>
</div>
</body>
</html>
