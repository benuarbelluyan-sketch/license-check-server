<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ Â· TG Parser Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: #0a0c10;
      color: #e5e9f0;
      line-height: 1.5;
    }

    .app {
      display: flex;
      min-height: 100vh;
    }

    /* Ð¡Ð°Ð¹Ð´Ð±Ð°Ñ€ */
    .sidebar {
      width: 280px;
      background: #0f1217;
      border-right: 1px solid #1e242c;
      padding: 24px 16px;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
    }

    .logo {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.5px;
      margin-bottom: 32px;
      padding-left: 12px;
    }

    .logo span {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 12px;
      color: #9aa4b2;
      margin-bottom: 4px;
      transition: all 0.2s;
      text-decoration: none;
    }

    .nav-item.active {
      background: #1a1f2a;
      color: #fff;
    }

    .nav-item i {
      width: 20px;
      font-size: 18px;
    }

    .nav-item:hover:not(.active) {
      background: #151a24;
      color: #e5e9f0;
    }

    /* ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ */
    .main {
      flex: 1;
      margin-left: 280px;
      padding: 32px 40px;
      background: #0a0c10;
      min-height: 100vh;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 600;
      letter-spacing: -0.5px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .admin-badge {
      background: #1a1f2a;
      padding: 8px 16px;
      border-radius: 40px;
      font-size: 14px;
      color: #9aa4b2;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logout-btn {
      background: #2d3340;
      border: none;
      color: #ff7b7b;
      padding: 8px 20px;
      border-radius: 40px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .logout-btn:hover {
      background: #3a4050;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: #0f1217;
      border: 1px solid #1e242c;
      border-radius: 20px;
      padding: 20px;
      transition: transform 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      border-color: #2d3540;
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: #1a1f2a;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      font-size: 20px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      color: #9aa4b2;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .stat-detail {
      font-size: 13px;
      color: #6b7a8f;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .stat-detail span.active { color: #7CFFB2; }
    .stat-detail span.expired { color: #ffd37b; }
    .stat-detail span.revoked { color: #ff7b7b; }

    /* Search & Filter */
    .action-bar {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 300px;
      display: flex;
      gap: 8px;
    }

    .search-box input {
      flex: 1;
      background: #0f1217;
      border: 1px solid #1e242c;
      border-radius: 40px;
      padding: 12px 20px;
      color: #e5e9f0;
      font-size: 14px;
    }

    .search-box input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .search-box select {
      background: #0f1217;
      border: 1px solid #1e242c;
      border-radius: 40px;
      padding: 0 20px;
      color: #e5e9f0;
    }

    .btn-primary {
      background: #3b82f6;
      border: none;
      border-radius: 40px;
      padding: 12px 32px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: #1e242c;
      border: 1px solid #2d3540;
      border-radius: 40px;
      padding: 12px 24px;
      color: #e5e9f0;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .btn-secondary:hover {
      background: #2a3140;
    }

    /* Create License Card */
    .create-card {
      background: #0f1217;
      border: 1px solid #1e242c;
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 32px;
    }

    .create-card h3 {
      margin-bottom: 20px;
      font-size: 18px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      background: #0a0c10;
      border: 1px solid #1e242c;
      border-radius: 12px;
      padding: 12px 16px;
      color: #e5e9f0;
    }

    .form-group input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .generate-section {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      padding-top: 16px;
      border-top: 1px solid #1e242c;
    }

    /* Table */
    .table-container {
      background: #0f1217;
      border: 1px solid #1e242c;
      border-radius: 20px;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th {
      text-align: left;
      padding: 18px 16px;
      color: #9aa4b2;
      font-weight: 500;
      border-bottom: 1px solid #1e242c;
    }

    td {
      padding: 16px;
      border-bottom: 1px solid #1e242c;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover td {
      background: #151a24;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 40px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge.active {
      background: rgba(124, 255, 178, 0.1);
      color: #7CFFB2;
      border: 1px solid rgba(124, 255, 178, 0.2);
    }

    .badge.expired {
      background: rgba(255, 211, 123, 0.1);
      color: #ffd37b;
      border: 1px solid rgba(255, 211, 123, 0.2);
    }

    .badge.revoked {
      background: rgba(255, 123, 123, 0.1);
      color: #ff7b7b;
      border: 1px solid rgba(255, 123, 123, 0.2);
    }

    .actions {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 6px 12px;
      border-radius: 30px;
      font-size: 12px;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .action-btn.ok {
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .action-btn.ok:hover {
      background: #22c55e;
      color: #fff;
    }

    .action-btn.warn {
      background: rgba(255, 123, 123, 0.1);
      color: #ff7b7b;
      border: 1px solid rgba(255, 123, 123, 0.2);
    }

    .action-btn.warn:hover {
      background: #ff7b7b;
      color: #fff;
    }

    .action-btn.secondary {
      background: rgba(155, 164, 178, 0.1);
      color: #9aa4b2;
      border: 1px solid rgba(155, 164, 178, 0.2);
    }

    .action-btn.secondary:hover {
      background: #2d3540;
      color: #fff;
    }

    .mono {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
    }

    .footer-note {
      margin-top: 20px;
      color: #6b7a8f;
      font-size: 13px;
      text-align: center;
    }
  </style>
</head>
<body>
<div class="app">
  <!-- Ð¡Ð°Ð¹Ð´Ð±Ð°Ñ€ -->
  <div class="sidebar">
    <div class="logo">
      <span>TG Parser</span> Sender
    </div>
    
    <a href="/admin" class="nav-item {% if active_tab == 'dashboard' %}active{% endif %}">
      <i>ðŸ“Š</i> Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´
    </a>
    <a href="/admin/licenses" class="nav-item {% if active_tab == 'licenses' %}active{% endif %}">
      <i>ðŸ”‘</i> Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ð¸
    </a>
    <a href="/admin/users" class="nav-item {% if active_tab == 'users' %}active{% endif %}">
      <i>ðŸ‘¥</i> ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸
    </a>
    <a href="/admin/devices" class="nav-item {% if active_tab == 'devices' %}active{% endif %}">
      <i>ðŸ’»</i> Ð£ÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°
    </a>
    <a href="/admin/transactions" class="nav-item {% if active_tab == 'transactions' %}active{% endif %}">
      <i>ðŸ’°</i> Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
    </a>
    <a href="/admin/settings" class="nav-item {% if active_tab == 'settings' %}active{% endif %}">
      <i>âš™ï¸</i> ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
    </a>
  </div>

  <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ -->
  <div class="main">
    <div class="header">
      <h1>Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´</h1>
      <div class="header-right">
        <div class="admin-badge">
          <span>ðŸ‘‘</span> ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€
        </div>
        <form method="post" action="/admin/logout" style="margin:0;">
          <button class="logout-btn" type="submit">Ð’Ñ‹Ð¹Ñ‚Ð¸</button>
        </form>
      </div>
    </div>

    <!-- Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">ðŸ”‘</div>
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">Ð’ÑÐµÐ³Ð¾ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸Ð¹</div>
        <div class="stat-detail">
          <span class="active">{{ stats.active }} Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ…</span>
          <span class="expired">{{ stats.expired }} Ð¿Ñ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð¾</span>
          <span class="revoked">{{ stats.revoked }} Ð·Ð°Ð±Ð»Ð¾Ðº.</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">ðŸ‘¥</div>
        <div class="stat-value">{{ stats.total_users }}</div>
        <div class="stat-label">ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸</div>
        <div class="stat-detail">
          <span style="color:#7CFFB2;">{{ stats.confirmed_users }}</span> Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ð»Ð¸ email
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">ðŸ’°</div>
        <div class="stat-value">${{ "%.2f"|format(stats.total_balance | default(0)) }}</div>
        <div class="stat-label">Ð‘Ð°Ð»Ð°Ð½Ñ</div>
        <div class="stat-detail">
          Ð¿Ð¾Ñ‚Ñ€Ð°Ñ‡ÐµÐ½Ð¾: ${{ "%.2f"|format(stats.total_revenue | default(0)) }}
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">ðŸ’»</div>
        <div class="stat-value">{{ stats.total_devices }}</div>
        <div class="stat-label">Ð£ÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°</div>
        <div class="stat-detail">
          Ñƒ {{ stats.users_with_devices }} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
        </div>
      </div>
    </div>

    <!-- ÐŸÐ¾Ð¸ÑÐº Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ -->
    <div class="action-bar">
      <div class="search-box">
        <input type="text" placeholder="ðŸ” ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ key, hwid, note..." value="{{ q or '' }}">
        <select>
          <option value="all" {% if status=="all" %}selected{% endif %}>Ð’ÑÐµ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹</option>
          <option value="active" {% if status=="active" %}selected{% endif %}>Active</option>
          <option value="expired" {% if status=="expired" %}selected{% endif %}>Expired</option>
          <option value="revoked" {% if status=="revoked" %}selected{% endif %}>Revoked</option>
        </select>
        <button class="btn-primary">ÐÐ°Ð¹Ñ‚Ð¸</button>
      </div>
      <a href="/admin/export" style="text-decoration:none;">
        <button class="btn-secondary">ðŸ“¥ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ CSV</button>
      </a>
    </div>

    <!-- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸Ð¸ -->
    <div class="create-card">
      <h3>âœ¨ Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸ÑŽ</h3>
      <form method="post" action="/admin/upsert">
        <div class="form-grid">
          <div class="form-group">
            <input name="key" placeholder="KEY (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ MY-PC-001)" required>
          </div>
          <div class="form-group">
            <input name="hwid" placeholder="HWID (UUID ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°)" required>
          </div>
          <div class="form-group">
            <input name="days" type="number" placeholder="Ð¡Ñ€Ð¾Ðº (Ð´Ð½Ð¸)" value="30" required>
          </div>
          <div class="form-group">
            <select name="plan">
              <option value="custom">custom (Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¹)</option>
              <option value="m1">m1 (1 Ð¼ÐµÑÑÑ†)</option>
              <option value="m3">m3 (3 Ð¼ÐµÑÑÑ†Ð°)</option>
              <option value="m6">m6 (6 Ð¼ÐµÑÑÑ†ÐµÐ²)</option>
              <option value="y1">y1 (1 Ð³Ð¾Ð´)</option>
            </select>
          </div>
          <div class="form-group">
            <input name="note" placeholder="Ð—Ð°Ð¼ÐµÑ‚ÐºÐ° (Ð½ÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾)">
          </div>
        </div>
        <div class="generate-section">
          <button class="btn-primary" type="submit">ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸ÑŽ</button>
          <span style="color:#9aa4b2;">Ð¸Ð»Ð¸</span>
          <button class="btn-secondary" type="button" onclick="alert('Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½: VIP-' + Math.random().toString(36).substring(7).toUpperCase())">ðŸŽ² Generate KEY</button>
          <span style="color:#6b7a8f; font-size:13px; margin-left:auto;">
            Ð¡Ð¾Ð²ÐµÑ‚: ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð¿Ñ€Ð¸ÑÑ‹Ð»Ð°ÐµÑ‚ HWID â†’ Ñ‚Ñ‹ Ð³ÐµÐ½ÐµÑ€Ð¸ÑˆÑŒ KEY
          </span>
        </div>
      </form>
    </div>

    <!-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸Ð¹ -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>KEY</th>
            <th>HWID</th>
            <th>Ð”ÐµÐ¹ÑÑ‚Ð²ÑƒÐµÑ‚ Ð´Ð¾</th>
            <th>Ð¡Ñ‚Ð°Ñ‚ÑƒÑ</th>
            <th>ÐŸÐ»Ð°Ð½</th>
            <th>ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¾Ðº</th>
            <th>Ð—Ð°Ð¼ÐµÑ‚ÐºÐ°</th>
            <th>Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ</th>
          </tr>
        </thead>
        <tbody>
        {% for r in rows %}
          <tr>
            <td class="mono"><b>{{ r.key }}</b></td>
            <td class="mono">{{ r.hwid[:16] }}...</td>
            <td class="mono">{{ r.expires_at.strftime('%Y-%m-%d') }}</td>
            <td>
              {% if r.revoked %}
                <span class="badge revoked">revoked</span>
              {% elif r.expires_at <= now %}
                <span class="badge expired">expired</span>
              {% else %}
                <span class="badge active">active</span>
              {% endif %}
            </td>
            <td><span class="badge">{{ r.plan }}</span></td>
            <td>{{ r.check_count }}</td>
            <td>{{ r.note or 'â€”' }}</td>
            <td>
              <div class="actions">
                <form method="post" action="/admin/add_days" style="display:inline;">
                  <input type="hidden" name="key" value="{{ r.key }}">
                  <input type="hidden" name="add" value="30">
                  <button class="action-btn ok" type="submit">+30</button>
                </form>
                <form method="post" action="/admin/add_days" style="display:inline;">
                  <input type="hidden" name="key" value="{{ r.key }}">
                  <input type="hidden" name="add" value="90">
                  <button class="action-btn secondary" type="submit">+90</button>
                </form>
                {% if r.revoked %}
                <form method="post" action="/admin/unrevoke" style="display:inline;">
                  <input type="hidden" name="key" value="{{ r.key }}">
                  <button class="action-btn secondary" type="submit">Unrevoke</button>
                </form>
                {% else %}
                <form method="post" action="/admin/revoke" style="display:inline;" onsubmit="return confirm('Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ»ÑŽÑ‡ {{ r.key }}?');">
                  <input type="hidden" name="key" value="{{ r.key }}">
                  <button class="action-btn warn" type="submit">Revoke</button>
                </form>
                {% endif %}
                <form method="post" action="/admin/delete" style="display:inline;" onsubmit="return confirm('Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÐºÐ»ÑŽÑ‡ {{ r.key }}? Ð­Ñ‚Ð¾ Ð½ÐµÐ¾Ð±Ñ€Ð°Ñ‚Ð¸Ð¼Ð¾!');">
                  <input type="hidden" name="key" value="{{ r.key }}">
                  <button class="action-btn warn" type="submit">Delete</button>
                </form>
              </div>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="footer-note">
      ÐŸÐ¾ÐºÐ°Ð·Ð°Ð½Ð¾ Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 500 Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ â€¢ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð¸ÑÐº Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹
    </div>
  </div>
</div>
</body>
</html>
