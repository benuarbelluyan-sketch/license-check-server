<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Сброс пароля · TG Parser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Inter,system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{background:#fff;border-radius:24px;padding:44px;max-width:520px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.2)}
    .title{font-size:26px;font-weight:800;color:#0f172a;margin-bottom:8px}
    .sub{color:#64748b;font-size:14px;margin-bottom:26px;line-height:1.5}
    label{display:block;font-size:13px;font-weight:700;color:#334155;margin-bottom:8px}
    input{width:100%;background:#f8fafc;border:2px solid #e2e8f0;border-radius:14px;padding:14px 16px;font-size:15px;outline:none}
    input:focus{border-color:#667eea;background:#fff;box-shadow:0 0 0 3px rgba(102,126,234,.12)}
    .btn{margin-top:14px;width:100%;border:none;border-radius:14px;padding:14px 16px;font-size:15px;font-weight:800;color:#fff;cursor:pointer;background:linear-gradient(135deg,#16a34a 0%,#22c55e 100%);box-shadow:0 6px 18px rgba(34,197,94,.25)}
    .msg{margin-top:16px;border-radius:14px;padding:12px 14px;font-weight:700;font-size:13px;display:none}
    .ok{background:#dcfce7;border:2px solid #86efac;color:#14532d}
    .err{background:#fee2e2;border:2px solid #fecaca;color:#7f1d1d}
    .foot{margin-top:18px;color:#94a3b8;font-size:12px;text-align:center}
  </style>
</head>
<body>
  <div class="card">
    <div class="title">Сброс пароля</div>
    <div class="sub">Придумайте новый пароль и сохраните.</div>

    <div id="msg" class="msg"></div>

    <label>Новый пароль</label>
    <input type="password" id="pwd" placeholder="Минимум 6 символов" required>

    <button class="btn" onclick="doReset()">Сохранить новый пароль</button>

    <div class="foot">TG Parser Sender</div>
  </div>

<script>
const TOKEN = "{{ token }}";

function showMsg(text, ok){
  const el = document.getElementById("msg");
  el.style.display = "block";
  el.className = "msg " + (ok ? "ok" : "err");
  el.textContent = text;
}

async function doReset(){
  const pwd = document.getElementById("pwd").value || "";
  if (pwd.length < 6){
    showMsg("Пароль слишком короткий (минимум 6 символов).", false);
    return;
  }
  try{
    const r = await fetch("/api/auth/reset-password", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({token: TOKEN, new_password: pwd})
    });
    const data = await r.json().catch(()=> ({}));
    if (r.ok && data.success){
      showMsg("✅ Пароль обновлён! Теперь можно вернуться в приложение и войти.", true);
    }else{
      const d = (data && (data.detail || data.error)) ? (data.detail || data.error) : "Ошибка";
      showMsg("❌ Не удалось сбросить пароль: " + d, false);
    }
  }catch(e){
    showMsg("❌ Ошибка сети. Попробуйте ещё раз.", false);
  }
}
</script>
</body>
</html>
